## 子网掩码详解 
[（来源链接）](https://blog.51cto.com/u_6930123/2112748)
### 二、CIDR与VLSM
理解和掌握了子网掩码这部分知识后，这里要补充下CIDR和VLSM，这对于我们下篇讲述的子网划分，简直了就是放大招啊！

1. 有类和无类网络，超网和子网
我们先了解这几个概念，对于CIDR和VLSM以及子网划分都是很有用的。

   - 有类网络：也叫主类网络或标准网络，就是指把IP地址能归结到的A类、B类、C类IP，使用的是标准的默认子网掩码。

   - 无类网络：相对于有类网络，无类网络IP地址的掩码是变长的。在有类网络的基础上，拿出一部分主机ID作为子网ID。

   - 超网：把多个小网络组合成一个大网络，称为超网（SuperNetting），也可以说子网掩码长度小于相对应的有类网络的叫超网。

   - 子网：有类网络划分成更小后的网络，称为子网（Subnet），也可以说子网掩码长度大于相对应的有类网络的叫子网。

2. CIDR无类别域间路由
   - CIDR（Classless Inter-Domain Routing，无类别域间路由）本质是消除了传统的A类、B类和C类地址以及划分子网的概念，将多个地址块聚合在一起生成一个更大的网络，从而包含更多的主机。

   - CIDR采用8-30位可变网络ID（最大可用的只能为30位，即保留2位给主机位），而不是A、B、C类网络ID所用的固定的8、16和24位。
   - CIDR表示方法：IP地址/n，n表示IP地址中的前n位代表网络部分（n个二进制数1），其余（32-n）位代表主机部分。这种方法称为“斜线记法”，它又称为CIDR记法。

> 举个栗子：子网掩码255.255.255.192，用CIDR表示是多少呢？
>
> ①、首先确认的是这是个C类网络地址（C类的默认子网掩码为255.255.255.0）
>
> ②、前面三个字节都是255，转换成二进制都为1，即11111111.11111111.11111111，即24位1。
>
> ③、后面一个字节是192，转换成二进制为11000000，即1占用了2位。
>
> ④、子网掩码共占用了26位1，所以用CIDR表示为/26。
>
> ⑤、如果网络地址为192.168.10.0，再加上CIDR，最后表示为192.168.10.0/26。

> CIDR支持路由聚合，能够将路由表中的许多路由条目合并为成更少的数目，因此可以限制路由器中路由表的增大，减少路由通告，减轻路由器的负担。

3. VLSM可变长子网掩码
   - VLSM（Variable Length Subnet Mask，可变长子网掩码）规定了在一个有类（A、B、C类）网络内包含多个子网掩码的能力，以及对一个子网的再进行子网划分的能力。
   - 每一个IP地址都包含了2部分：网络号和主机号。在有类网络中，32bit的IP地址被分为4段，每段8bit来表示。这使得作为网络号的前缀必须是8位，16位或者24位。当网络号是24位的时候，主机号只有8位，也就是说，可分配的最小的地址块是256个（2^8=256，而实际可分配的主机地址还要减去两个，一个是网络地址，一个是广播地址，最后为254个），这个数量对于大多数企业来说是不够的。
   - 而比这个大一点的IP地址块是网络号为16位的时候，这个时候可分配的地址块是65536（2^16=65536），这个数量对于大多数公司又太多了。这导致无论公司选择哪种类型的网络，都可能对IP地址造成大量的浪费。
   - IP地址如果只使用有类（A、B、C类）来划分，会造成大量的浪费或者不够用。VLSM的诞生有效的解决了这个问题，可以在有类网络的基础上，通过对IP地址的主机号进行再划分，把一部分划入网络号，就能划分各种类型大小的网络了。网络号也不再仅局限在8、16和24位这几个数，而是灵活变化的大小了。

4. CIDR与VLSM的区别
   - 在使用CIDR聚合地址时，将原来有类IP地址中的网络位划出一部分作为主机位使用。
   - 在使用VLSM划分子网时，将原来有类IP地址中的主机位按照需要划出一部分作为网络位使用。
   - CIDR：子网掩码往左边移，掩码netmask缩短了。
   - VLSM：子网掩码往右边移，掩码netmask增长了。
   - CIDR是把几个有类网络合成一个大的网络（超网），用于路由地址聚合。
   - VLSM是把一个有类网络分成几个小型网络（子网），用于更高效划分子网。
   - CIDR与VLSM总结：
     - 在某种程度上来说，CIDR和VLSM它们之间可以看做是逆过程。
     - CIDR是把几个小网络聚合成一个大网络来做表示，而VLSM则是把一个大网络继续细分为几个小网络进行IP地址分配。
     - CIDR能让路由器的路由条目得到有效的减少，从而减少路由通告，降低路由器负担，而VLSM则是充分利用IP进行地址分配来解决IP地址不被浪费的问题，节约IP地址空间，更为有效的使用。
---
## 子网划分
### 一、子网划分概述
1. 为什么要划分子网？
IPv4地址如果只使用有类（A、B、C类）来划分，会造成大量的浪费或者不够用，为了解决这个问题，可以在有类网络的基础上，通过对IP地址的主机号进行再划分，把一部分划入网络号，就能划分各种类型大小的网络了。

2. IPv4子网划分与聚合
为了解决IPv4的不足，提高网络划分的灵活性，诞生了两种非常重要的技术，那就是VLSM（可变长子网掩码）和CIDR（无类别域间路由），把传统标准的IPv4有类网络演变成一个更为高效，更为实用的无类网络。关于VLSM和CIDR的介绍参考上篇 子网掩码详解有讲述。

>VLSM用于IPv4子网的划分，也就是把一个大的网络划分成多个小的子网；而CIDR则用于IPv4子网的聚合，当然主要是指路由方面的聚合，也就是路由汇总。通过CIDR可以把多个小的子网路由条目汇总成一个大网络的路由条目，以减少路由器中路由条目的数量，提高路由效率。

### 二、子网划分方法
我们所讲的子网划分其实就是基于VLSM可变长子网掩码的划分，子网划分又分为等长子网划分和变长子网划分。

1. VLSM子网划分的基本思想
通过VLSM实现子网划分的基本思想很简单：就是借用现有网段的主机位的最左边某几位作为子网位，划分出多个子网。

   - 把原来有类网络IPv4地址中的“网络ID”部分向“主机ID”部分借位

   - 把一部分原来属于“主机ID”部分的位变成“网络ID”的一部分（通常称之为“子网ID”）。

   - 原来的“网络ID”+“子网ID”=新“网络ID”。“子网ID”的长度决定了可以划分子网的数量。

如下示例图：

![](https://tuchuang-jiachzha.oss-cn-hangzhou.aliyuncs.com/img/cc05ee8e14483fc9144d7f74397aa78e.png)
![](https://tuchuang-jiachzha.oss-cn-hangzhou.aliyuncs.com/img/b238a2ab335a04d7c47484f6d6b63528.png)
![](https://tuchuang-jiachzha.oss-cn-hangzhou.aliyuncs.com/img/2e44e2a13a05f4de228f0a1eec2f173c.png)
最终结果：

子网掩码：255.255.255.224 （/27）

A子网的网络地址：192.168.0.0/27，可用地址（192.168.0.1～192.168.0.30），广播地址：192.168.0.31。

B子网的网络地址：192.168.0.32/27，可用地址（192.168.33～192.168.0.62），广播地址：192.168.0.63。

C子网的网络地址：192.168.0.64/27，可用地址（192.168.65～192.168.0.94），广播地址：192.168.0.95。

D子网的网络地址：192.168.0.96/27，可用地址（192.168.97～192.168.0.126），广播地址：192.168.0.127。

E子网的网络地址：192.168.0.128/27，可用地址（192.168.129～192.168.0.158），广播地址：192.168.0.159。

F子网的网络地址：192.168.0.160/27，可用地址（192.168.161～192.168.0.190），广播地址：192.168.0.191。

G子网的网络地址：192.168.0.192/27，可用地址（192.168.193～192.168.0.222），广播地址：192.168.0.223。

H子网的网络地址：192.168.0.224/27，可用地址（192.168.225～192.168.0.254），广播地址：192.168.0.255。

2. B类网络子网划分示例
将131.107.0.0/16等分成2个子网，写出各个子网的第一个和最后一个可用的IP地址？

分析：要划分为2个子网，就要借用主机位1位作为子网位。

0是A子网
1是B子网

借用主机1位，所以子网掩码+1位，由原来的255.255.0.0 （/16）变为255.255.128.0（/17）

结论：B类网络等分成2个子网，子网掩码往右移动1位，就能等分成2个子网，即2^1。

最终结果：

A子网
网络地址：131.107.0.0/17，
可用地址（131.107.0.1 ~ 131.107.127.254）
广播地址：131.107.127.255

B子网
网络地址：131.107.128.0/17
可用地址（131.107.128.1 ~ 131.107.255.254）
广播地址：131.107.255.255

![](https://tuchuang-jiachzha.oss-cn-hangzhou.aliyuncs.com/img/ddcabb080e751306e58335a533daeb20.png)

### 三、变长子网划分
VLSM规定了如何在一个进行了子网划分的网络中，不同子网使用不同的子网掩码。这对于网络内部不同网段需要不同大小子网的情形来说很有效，这种划分子网的方式叫变长子网划分。

变长子网划分其实就是在等长子网的划分上，分别取不同等分子网中的某个或者多个子网。

变长子网划分示例
![变长子网划分示例](https://tuchuang-jiachzha.oss-cn-hangzhou.aliyuncs.com/img/de085bbf8eb4753018b7e8c8bbbad651.png)

1、确定划分子网数
子网数 = 2^n，n代表子网掩码往右移动的位数
例如：
要划分2个子网，子网掩码需要往右移动1位，2^1=2
要划分4个子网，子网掩码需要往右移动2位，2^2=4
要划分8个子网，子网掩码需要往右移动3位，2^3=8
…
子网数只能为2倍的关系划分。

2、确定子网划分后的地址
每个子网地址块大小（IP_block）= 2^(8-n)
每个子网可用地址个数（IP_num）= 2^(8-n)-2
①、子网的网络地址 = 从0到255，取每段地址块的首个值
②、子网的广播地址 = 下一个子网的网络地址-1
③、子网的可用地址 = 子网的网络地址到子网的广播地址区间

例如：
要划分为4个网段（2^2），子网掩码右移2位
每个子网地址块大小（IP_block）= 2^(8-4) = 64
每个子网可用地址个数（IP_num）= 2^(8-4)-2 = 62
每段取值分别为：0，64，128，192
第一个子网
①、网络地址 = 0
②、广播地址 = 63
③、可用地址 = 1到62

第二个子网
①、网络地址 = 64
②、广播地址 = 127
③、可用地址 = 65到126

第三个子网
①、网络地址 = 128
②、广播地址 = 191
③、可用地址 = 129到190

第四个子网
①、网络地址 = 192
②、广播地址 = 255
③、可用地址 = 193到254

3、确定子网掩码
划分后的子网掩码CIDR = 原网络的子网掩码CIDR+n，如要写成十进制：256-2^(8-n)
例如：
原来子网掩码：255.255.255.0（/24），往右移动3位，则划分为8个子网
子网掩码就变为为 /27，256-2^(8-3) = 256-2^5 = 256-32 = 224
最后子网掩码结果：255.255.255.224（/27）

如还有不明白的，请参照上面给出的VLSM可变长子网掩码对应CIDR值这个图就一目了然。

--------------------

## 三、超网合并
### 一、超网的概念
      超网(Supernetting)是与子网类似的概念，IP地址根据子网掩码被分为独立的网络地址和主机地址。
      超网，也称无类别域间路由选择（CIDR），它是集合多个同类互联网地址的一种方法。

      与子网划分（把大网络分成若干小网络）相反，它是把一些小网络组合成一个大网络，就是超网。

### 二、超网合并网段
1. 合并网段
   示例：某企业有一个网段，该网段有200台主机，使用192.168.0.0 255.255.255.0网段。

   后来计算机数量增加到400台，为后来增加的200台主机使用192.168.1.0 255.255.255.0网段，如下图：

   ![](https://tuchuang-jiachzha.oss-cn-hangzhou.aliyuncs.com/img/f47b84ff5c676c5ab1c7b164777c3255.png)

   网段合并：子网掩码向前移动1位，使得网络部分保持前部分相同。

   注：子网掩码往左移1位，能够合并2个连续的网段，但不是任何连续的网段都能合并。

   合并网段之后，如下图，这样所有主机相互通信就不再经过路由器转发了。
   ![](https://tuchuang-jiachzha.oss-cn-hangzhou.aliyuncs.com/img/b7a8122e3f4cb53da6150d1e665ed15e.png)

2. 不是任何连续的网段都能合并
   示例，如下两个连续的网段是不能合并（往前移动1位，网络部分不能保持相同）的。
   ![](https://tuchuang-jiachzha.oss-cn-hangzhou.aliyuncs.com/img/3856bdd5d929cc7a387cdde9f897d7ea.png)

3. 哪些连续的网段能够合并
>判断2个网段是否能够合并
![](https://tuchuang-jiachzha.oss-cn-hangzhou.aliyuncs.com/img/9d6bf7bb37c193e6ff334f315c7bbab4.png)

>**结论：**判断连续的4个网段是否能够合并，只要第一个网络号能被4整除，就能够通过左移2位子网掩码合并。

>依次类推，要想判断连续的8个网段是否能够合并，只要第一个网络号能被8整除，这8个连续的网段就能够通过左移3位子网掩码合并。

4. 网段合并的规律
子网掩码左移1位能够将能够合并两个网段，左移2位，能够合并四个网段，左移3位，能够合并8个网段。
![](https://tuchuang-jiachzha.oss-cn-hangzhou.aliyuncs.com/img/8a0dbd60f0d4db1a709e316c7b2628c4.png)


5. 判断一个网段是超网还是子网
   - 通过左移子网掩码合并多个网段，右移子网掩码将一个网段划分成多个子网，使得IP地址打破了传统的A类、B类、C类的界限。

   - 判断一个网段到底是子网还是超网，就要看该网段是A类网络、还是B类网络、还是C类网络，默认A类子网掩码/8，B类子网掩码是/16，C类子网掩码是/24。

   - 如果该网段的子网掩码比默认子网掩码长，就是子网，如果该网段的子网掩码比默认子网掩码短，则是超网。

-------